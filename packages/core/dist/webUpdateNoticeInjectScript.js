var T=(t,i,e)=>new Promise((s,a)=>{var n=o=>{try{r(e.next(o))}catch(p){a(p)}},u=o=>{try{r(e.throw(o))}catch(p){a(p)}},r=o=>o.done?s(o.value):Promise.resolve(o.value).then(n,u);r((e=e.apply(t,i)).next())});var x="pluginWebUpdateNotice",S="web_version_by_plugin";var v="plugin_web_update_notice",A="plugin-web-update-notice-anchor",U="plugin-web-update-notice-refresh-btn",M="plugin-web-update-notice-dismiss-btn",y="web_update_check_dismiss_version_",$={topLeft:"top: 24px;left: 24px",topRight:"top: 24px;right: 24px",bottomLeft:"bottom: 24px;left: 24px",bottomRight:"bottom: 24px;right: 24px"};var H={zh_CN:{title:"\u53D1\u73B0\u65B0\u7248\u672C",description:"\u7F51\u9875\u66F4\u65B0\u5566\uFF01\u8BF7\u5237\u65B0\u9875\u9762\u540E\u4F7F\u7528\u3002",buttonText:"\u5237\u65B0",dismissButtonText:"\u5FFD\u7565"},zh_TW:{title:"\u767C\u73FE\u65B0\u7248\u672C",description:"\u7DB2\u9801\u66F4\u65B0\u5566\uFF01\u8ACB\u5237\u65B0\u9801\u9762\u5F8C\u4F7F\u7528\u3002",buttonText:"\u5237\u65B0",dismissButtonText:"\u5FFD\u7565"},en_US:{title:"Discover new version",description:"A new version is available! Please refresh the page.",buttonText:"Refresh",dismissButtonText:"Dismiss"}},w=H;var L=!1,h="",N="",C;function F(t,i){let e=!1;return function(...s){e||(e=!0,t.apply(this,s),setTimeout(()=>{e=!1},i))}}function O(t){return document.querySelector(t)}window.pluginWebUpdateNotice_={checkUpdate:()=>{},dismissUpdate:k,closeNotification:R,setLocale:t=>{window.pluginWebUpdateNotice_.locale=t,N=t}};var D=t=>window.fetch(`${t}${x}/${S}.json?t=${Date.now()}`).then(i=>{if(!i.ok)throw new Error(`Failed to fetch ${S}.json from ${t}`);return i.json()}).catch(i=>{Promise.reject(i)}),q=t=>T(void 0,null,function*(){for(let i of t)try{let{version:e}=yield D(i.fileBase);window[`${i.name}_pluginWebUpdateNotice_version`]=e}catch(e){continue}});function J(t){let{injectFileBase:i="",checkInterval:e=10*60*1e3,hiddenDefaultNotification:s,checkOnWindowFocus:a=!0,checkImmediately:n=!0,checkOnLoadFileError:u=!0,moduleFederationList:r=[]}=t;r.length&&q(r);let o=(c=i,_="")=>D(c).then(({version:l,silence:g})=>{if(g)return;h=l;let I=_?`${_}_pluginWebUpdateNotice_version`:"pluginWebUpdateNotice_version";if(window[I]!==l){document.body.dispatchEvent(new CustomEvent(v,{detail:{options:t,moduleFederationName:_,version:l},bubbles:!0}));let E=localStorage.getItem(`${y}${l}`)==="true";return!L&&!s&&!E&&V(t),!0}return!1}).catch(l=>(console.error(`[${_||"pluginWebUpdateNotice"}] Failed to check system update`,l),!1)),p=()=>T(this,null,function*(){for(let c of r)if(yield o(c.fileBase,c.name))break});n&&setTimeout(o);let b=()=>{e>0&&(C=setInterval(o,e))};b();let d=F(o,5e3),f=F(p,5e3);window.pluginWebUpdateNotice_.checkUpdate=d,window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(b(),a&&d()),document.visibilityState==="hidden"&&C&&clearInterval(C)}),window.addEventListener("focus",()=>{a&&d()}),u&&window.addEventListener("error",c=>T(this,null,function*(){var l;((l=c==null?void 0:c.target)==null?void 0:l.tagName)==="SCRIPT"&&((yield d())||f())}),!0)}window.__checkUpdateSetup__=J;function R(){var t;L=!1,(t=O(`.${A} .plugin-web-update-notice`))==null||t.remove()}function k(){try{R(),localStorage.setItem(`${y}${h}`,"true")}catch(t){console.error(t)}}function P(){let t=O(`.${U}`);t==null||t.addEventListener("click",()=>{let{onClickRefresh:e}=window.pluginWebUpdateNotice_;if(e){e(h);return}window.location.reload()});let i=O(`.${M}`);i==null||i.addEventListener("click",()=>{let{onClickDismiss:e}=window.pluginWebUpdateNotice_;if(e){e(h);return}k()})}function m(t,i,e){var s,a,n,u;return(u=(n=(s=e[t])==null?void 0:s[i])!=null?n:(a=w[t])==null?void 0:a[i])!=null?u:w.zh_CN[i]}function V(t){var i,e,s,a;try{L=!0;let{notificationProps:n,notificationConfig:u,customNotificationHTML:r,hiddenDismissButton:o,locale:p="zh_CN",localeData:b}=t,d=Object.assign({},w,b);N||(N=p,window.pluginWebUpdateNotice_.locale=p);let f=document.createElement("div"),c="";if(r)c=r;else{let{placement:_="bottomRight",primaryColor:l,secondaryColor:g}=u||{},I=(i=n==null?void 0:n.title)!=null?i:m(N,"title",d),E=(e=n==null?void 0:n.description)!=null?e:m(N,"description",d),W=(s=n==null?void 0:n.buttonText)!=null?s:m(N,"buttonText",d),B=(a=n==null?void 0:n.dismissButtonText)!=null?a:m(N,"dismissButtonText",d),j=o?"":`<a class="plugin-web-update-notice-btn plugin-web-update-notice-dismiss-btn" style="color:${g}">${B}</a>`;f.classList.add("plugin-web-update-notice"),f.style.cssText=`${$[_]}`,c=`
    <div class="plugin-web-update-notice-content" data-cy="notification-content">
      <div class="plugin-web-update-notice-content-title">
        ${I}
      </div>
      <div class="plugin-web-update-notice-content-desc">
        ${E}
      </div>
      <div class="plugin-web-update-notice-tools">
        ${j}
        <a class="plugin-web-update-notice-btn plugin-web-update-notice-refresh-btn" style="color:${l}">
          ${W}
        </a>
      </div>
    </div>`}f.innerHTML=c,document.querySelector(`.${A}`).appendChild(f),P()}catch(n){console.error("[pluginWebUpdateNotice] Failed to show notification",n)}}export{J as __checkUpdateSetup__};
