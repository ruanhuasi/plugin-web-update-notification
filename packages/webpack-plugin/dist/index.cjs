"use strict";var d=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var O=(s,e)=>{for(var n in e)d(s,n,{get:e[n],enumerable:!0})},S=(s,e,n,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of y(e))!E.call(s,o)&&o!==n&&d(s,o,{get:()=>e[o],enumerable:!(l=j(e,o))||l.enumerable});return s};var H=s=>S(d({},"__esModule",{value:!0}),s);var I={};O(I,{WebUpdateNotificationPlugin:()=>C});module.exports=H(I);var r=require("fs"),N=require("path"),t=require("@plugin-ofs-web-update-notification/core"),F="WebUpdateNotificationPlugin";function P(s,e,n,{cssFileHash:l,jsFileHash:o}){let{customNotificationHTML:u,hiddenDefaultNotification:a,injectFileBase:h="/"}=n,f=`<script>window.pluginWebUpdateNotice_version = '${e}';</script>`,$=u||a?"":`<link rel="stylesheet" href="${h}${t.DIRECTORY_NAME}/${t.INJECT_STYLE_FILE_NAME}.${l}.css">`,i=s;return i=i.replace("<head>",`<head>
    ${$}
    <script src="${h}${t.DIRECTORY_NAME}/${t.INJECT_SCRIPT_FILE_NAME}.${o}.js"></script>

    ${f}`),a||(i=i.replace("</body>",`<div class="${t.NOTIFICATION_ANCHOR_CLASS_NAME}"></div></body>`)),i}var C=class{constructor(e){this.options=e||{}}apply(e){let n="",l="",{publicPath:o}=e.options.output;this.options.injectFileBase===void 0&&(this.options.injectFileBase=typeof o=="string"?o:"/");let{hiddenDefaultNotification:u,versionType:a,indexHtmlFilePath:h,customVersion:f,silence:$}=this.options,i="";a==="custom"?i=(0,t.getVersion)(a,f):i=(0,t.getVersion)(a),e.hooks.emit.tap(F,c=>{let p=(0,t.generateJSONFileContent)(i,$);if(c.assets[`${t.DIRECTORY_NAME}/${t.JSON_FILE_NAME}.json`]={source:()=>p,size:()=>p.length},!u){let g=(0,r.readFileSync)(`${(0,t.get__Dirname)()}/${t.INJECT_STYLE_FILE_NAME}.css`,"utf8");l=(0,t.getFileHash)(g),c.assets[`${t.DIRECTORY_NAME}/${t.INJECT_STYLE_FILE_NAME}.${l}.css`]={source:()=>g,size:()=>g.length}}let _=(0,N.resolve)(`${(0,t.get__Dirname)()}/${t.INJECT_SCRIPT_FILE_NAME}.js`),m=(0,t.generateJsFileContent)((0,r.readFileSync)(_,"utf8").toString(),i,this.options);n=(0,t.getFileHash)(m),c.assets[`${t.DIRECTORY_NAME}/${t.INJECT_SCRIPT_FILE_NAME}.${n}.js`]={source:()=>m,size:()=>m.length}}),e.hooks.afterEmit.tap(F,()=>{let c=(0,N.resolve)(e.outputPath,h||"./index.html");try{(0,r.accessSync)(c,r.constants.F_OK);let p=(0,r.readFileSync)(c,"utf8");p=P(p,i,this.options,{jsFileHash:n,cssFileHash:l}),(0,r.writeFileSync)(c,p)}catch(p){console.error(p),console.error(`${F} failed to inject the plugin into the HTML file. index.html\uFF08${c}\uFF09 not found.`)}})}};0&&(module.exports={WebUpdateNotificationPlugin});
//# sourceMappingURL=index.cjs.map