import{readFileSync as m}from"fs";import{resolve as $}from"path";import{DIRECTORY_NAME as l,INJECT_SCRIPT_FILE_NAME as u,INJECT_STYLE_FILE_NAME as d,JSON_FILE_NAME as N,NOTIFICATION_ANCHOR_CLASS_NAME as C,generateJSONFileContent as E,generateJsFileContent as S,getFileHash as F,getVersion as _,get__Dirname as v}from"@plugin-ofs-web-update-notification/core";function y(s,a,r,{cssFileHash:p,jsFileHash:g}){let{customNotificationHTML:t,hiddenDefaultNotification:i,injectFileBase:n=""}=r,f=`<script>window.pluginWebUpdateNotice_version = '${a}';</script>`,o=t||i?"":`<link rel="stylesheet" href="${n}${l}/${d}.${p}.css">`,e=s;return e=e.replace("<head>",`<head>
    ${o}
    <script src="${n}${l}/${u}.${g}.js"></script>
    ${f}`),i||(e=e.replace("</body>",`<div class="${C}"></div></body>`)),e}function H(s={}){let a,{versionType:r,customVersion:p,silence:g}=s,t="";r==="custom"?t=_(r,p):t=_(r);let i="",n="",f=m(`${$(v(),d)}.css`,"utf8").toString();n=F(f);let o="";return{name:"vue-vite-web-update-notice",apply:"build",enforce:"post",async configResolved(e){a=e,s.injectFileBase===void 0&&(s.injectFileBase=a.base),o=S(m(`${$(v(),u)}.js`,"utf8").toString(),t,s),i=F(o)},generateBundle(e,c={}){t&&(c[N]={isAsset:!0,type:"asset",name:void 0,source:E(t,g),fileName:`${l}/${N}.json`},c[d]={isAsset:!0,type:"asset",name:void 0,source:f,fileName:`${l}/${d}.${n}.css`},c[u]={isAsset:!0,type:"asset",name:void 0,source:o,fileName:`${l}/${u}.${i}.js`})},transformIndexHtml:{order:"post",handler(e,{chunk:c}){return t&&c?y(e,t,s,{jsFileHash:i,cssFileHash:n}):e},enforce:"post",async transform(e){return t?y(e,t,s,{jsFileHash:i,cssFileHash:n}):e}}}}export{H as webUpdateNotice};
//# sourceMappingURL=index.js.map