"use strict";var m=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var O=(i,e)=>{for(var s in e)m(i,s,{get:e[s],enumerable:!0})},S=(i,e,s,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of y(e))!E.call(i,n)&&n!==s&&m(i,n,{get:()=>e[n],enumerable:!(r=j(e,n))||r.enumerable});return i};var A=i=>S(m({},"__esModule",{value:!0}),i);var H={};O(H,{WebUpdateNotificationPlugin:()=>_});module.exports=A(H);var o=require("fs"),N=require("path"),t=require("@plugin-ofs-web-update-notification/core"),F="WebUpdateNotificationPlugin";function P(i,e,s,{cssFileHash:r,jsFileHash:n}){let{hiddenDefaultNotification:u,injectFileBase:l="/"}=s,f=`<script>window.pluginWebUpdateNotice_version = '${e}';</script>`,$=u?"":`<link rel="stylesheet" href="${l}${t.DIRECTORY_NAME}/${t.INJECT_STYLE_FILE_NAME}.${r}.css">`;return i=i.replace("</head>",`${$}
    <script src="${l}${t.DIRECTORY_NAME}/${t.INJECT_SCRIPT_FILE_NAME}.${n}.js"></script>
    ${f}
    </head>`),u||(i=i.replace("</body>",`<div class="${t.NOTIFICATION_ANCHOR_CLASS_NAME}"></div></body>`)),i}var _=class{constructor(e){this.options=e||{}}apply(e){let s="",r="",{publicPath:n}=e.options.output;this.options.injectFileBase===void 0&&(this.options.injectFileBase=typeof n=="string"?n:"/");let{hiddenDefaultNotification:u,versionType:l,indexHtmlFilePath:f,customVersion:$,silence:C}=this.options,a="";l==="custom"?a=(0,t.getVersion)(l,$):a=(0,t.getVersion)(l),e.hooks.emit.tap(F,h=>{let c=(0,t.generateJSONFileContent)(a,C);if(h.emitAsset[`${t.DIRECTORY_NAME}/${t.JSON_FILE_NAME}.json`]={source:()=>c,size:()=>c.length},!u){let g=(0,o.readFileSync)(`${(0,t.get__Dirname)()}/${t.INJECT_STYLE_FILE_NAME}.css`,"utf8");r=(0,t.getFileHash)(g),h.emitAsset[`${t.DIRECTORY_NAME}/${t.INJECT_STYLE_FILE_NAME}.${r}.css`]={source:()=>g,size:()=>g.length}}let p=(0,N.resolve)(`${(0,t.get__Dirname)()}/${t.INJECT_SCRIPT_FILE_NAME}.js`),d=(0,t.generateJsFileContent)((0,o.readFileSync)(p,"utf8").toString(),a,this.options);s=(0,t.getFileHash)(d),h.emitAsset[`${t.DIRECTORY_NAME}/${t.INJECT_SCRIPT_FILE_NAME}.${s}.js`]={source:()=>d,size:()=>d.length}}),e.hooks.afterEmit.tap(F,()=>{let h=e.options.output.path||"./dist",c=(0,N.resolve)(h,f||"./index.html");try{(0,o.accessSync)(c,o.constants.F_OK);let p=(0,o.readFileSync)(c,"utf8");p=P(p,a,this.options,{jsFileHash:s,cssFileHash:r}),(0,o.writeFileSync)(c,p)}catch{console.error(`${F} failed to inject the plugin into the HTML file. index.html (${c}) not found.`)}})}};0&&(module.exports={WebUpdateNotificationPlugin});
//# sourceMappingURL=index.cjs.map